<!DOCTYPE HTML>
<!--[if lt IE 7]>      <html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class=""> <!--<![endif]-->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>新东方在线教师备课平台</title>
<link href="css/global.css" rel="stylesheet" type="text/css">
<link href="css/DTotal.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="css/jquery.autocomplete.css">
<!--[if lt IE 9]>
<script src="js/html5.js"></script>
<![endif]-->

<!-- 授权管理 用户列表 模板 -->
<script id="listUserKinguserTemplate" type="text/x-dot-template">
    <tr data-fdid="{{=it.id}}">
        <td class="tdTit">
            <div class="state-dragable"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></div>
            <img src="{{=it.imgUrl || 'images/temp-face36.jpg'}}" alt="">{{=it.name}}（{{=it.mail}}），{{=it.org}} {{=it.department}}
        </td>
        <td><input type="checkbox" checked class="tissuePreparation" /></td>
        <td><input type="checkbox" class="editingCourse" /></td>
        <td><a href="#" class="icon-remove-blue"></a></td>
    </tr>
</script>

    <script src="js/doT.min.js"></script>
</head>

<body>
<header class="navbar navbar-inverse navbar-fixed-top">
	<div class="navbar-inner">
    	<div class="container">
			<a href="#" class="logo"></a>
	        <ul class="nav">
	          <li><a href="#">系统管理</a></li>
	          <li><a href="#">我是导师</a></li>
	          <li><a href="#">我是主管</a></li>
	        </ul>
			
            <ul class="nav pull-right">
              <li class="dropdown">
              	<a href="#" class="dropdown-toggle" data-toggle="dropdown" >
                	<span class="top-face"><img src="./images/temp-face.jpg" alt=""><i class="icon-disc"></i></span>
                    <span class="name">杨义锋</span>
                    <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                	<li><a href="#"><i class="icon-home"></i>备课首页</a></li>
                    <li><a href="#"><i class="icon-envelope"></i>我的私信<span class="icon-disc-bg">2</span></a></li>
                    <li><a href="profile.html"><i class="icon-user"></i>个人资料</a></li>
                    <li><a href="changePwd.html"><i class="icon-pencil"></i>修改密码</a></li>
                    <li><a href="#"><i class="icon-off"></i>退出平台</a></li>
                </ul>
              </li>
              <li><a href="#" class="btn-off"></a></li>
            </ul>
		</div>
    </div>
</header>

<section class="container">
	<section class="clearfix mt20">
	  <section class="col-left pull-left">
    	<ul class="nav nav-list sidenav" id="sideNav">
                <li class="nav-header first"><a href="#">学习跟踪</a></li>
                <li class="nav-header"><a href="#">授权学习</a></li>
	            <li class="nav-header">
                    <span>课程管理</span>
	            </li>
	            <li><a href="#"><i class="icon-course-series"></i>我的系列课程</a></li>
	            <li><a href="#"><i class="icon-course"></i>我的课程</a></li>
	             <li class="nav-header">
                     <span>课程素材库</span>
	            </li>
                <li class="active"><a href="#"><i class="icon-video"></i>视频</a></li>
                <li><a href="#"><i class="icon-doc"></i>文档</a></li>
                <li><a href="#"><i class="icon-ppt"></i>幻灯片</a></li>
                <li><a href="#"><i class="icon-exam"></i>测试</a></li>
                <li><a href="#"><i class="icon-task"></i>作业</a></li>
	    </ul>
	  </section>
		<section class="w790 pull-right" id="rightCont">
	        <div class="page-header">
                <a href="素材库-视频列表.html" class="backParent">返回视频列表</a>
                <h4>雅思写作强化DEMO第03课</h4>
                <div class="btn-group">
                    <button class="btn btn-large btn-primary" type="button">保存</button>
                    <button class="btn btn-large btn-primary" type="button">下载</button>
                    <button class="btn btn-white btn-large " type="button">删除</button>
                </div>
	        </div>
            <div class="page-body editingBody">
                <form action="#" id="formEditDTotal" class="form-horizontal" method="post">
                    <section class="section">
                        <div class="control-group">
                            <label class="control-label" for="videoName">视&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;频</label>
                            <div class="controls">
                                <input value="雅思写作强化DEMO第03课" id="videoName" required class="span6"
                                       name="videoName" type="text"><span class="date">2013/02/14 10:01 AM</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" >统&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计</label>
                            <div class="controls controls-txt">
                                <span class="rating-view">
                                    <span class="rating-all">
                                        <i class="icon-star active"></i><i class="icon-star active"></i><i class="icon-star"></i><i class="icon-star"></i><i class="icon-star"></i>
                                     </span>
                                      <b class="text-warning">2.0</b>
                                </span>
                                <span class="btns-handle">
                                    <b>|</b>
                                    <button type="button" class="btn btn-link"><i class="icon-eye"></i><strong>3315</strong></button>
                                     <b>|</b>
                                    <button type="button" class="btn btn-link"><i class="icon-thumbs-up"></i><strong>1530</strong></button>
                                     <b>|</b>
                                    <button type="button" class="btn btn-link"><i class="icon-download"></i><strong>0</strong></button>
                                </span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="videoUrl">播放地址</label>
                            <div class="controls"><input value="rtmp://video.xdf.cn/V3/office/kmss/resources/www/201301/25134333gtwn.mp4" readonly placeholder="请认真填写该章节的 建议学习时长"
                                                         id="videoUrl" class="input-block-level" name="videoUrl" type="text">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="videoIntro">视频简介</label>
                            <div class="controls"><textarea placeholder="非必填项" rows="4"
                                                            class="input-block-level" id="videoIntro"
                                                            name="videoIntro"></textarea>
                            </div>
                        </div>
                    </section>
                    <section class="section mt20">
                        <label>上传视频（支持MP4、AVI、WMV格式的视频，建议小于10G）：成功上传的视频将会显示在下面的视频列表中。</label>
                        <div class="control-upload">
                            <span class="progress"> <div class="bar" style="width:20%;"></div> </span>
                            <span class="txt"><span>20%</span>，剩余时间：<span>00:00:29</span></span>
                            <button class="btn btn-primary btn-large" type="button">上传</button>
                        </div>
                    </section>
                    <section class="section mt20">
                        <div class="media-placeholder">
                            格式转换中 ... ...
                        </div>
                    </section>
                    <section class="section">
                        <div class="control-group">
                            <label class="control-label" for="author">作&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;者</label>
                            <div class="controls">
                                <input value="集团国外考试推广管理中心" id="author" required class="input-block-level"
                                       name="author" type="text">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="authorIntro">作者简介</label>
                            <div class="controls"><textarea placeholder="非必填项" rows="4"
                                                            class="input-block-level" id="authorIntro"
                                                            name="authorIntro"></textarea>
                            </div>
                        </div>
                    </section>
                    <div class="page-header mt20"> <h4>权限设置</h4> </div>
                    <section class="section">
                        <label>权限设置<input type="hidden" id="permission" name="permission" value="open"></label>
                        <ul class="nav nav-pills">
                            <li class="active"><a data-toggle="tab" href="#open">公开</a></li>
                            <li><a data-toggle="tab" href="#encrypt">加密</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="open">
                                提示：“公开”素材将允许所有主管在管理课程的过程中使用，而“加密”素材将允许您手动授权某些主管使用本课程素材。
                            </div>
                            <div class="tab-pane" id="encrypt">
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>授权用户</th>
                                        <th>组织备课</th>
                                        <th>编辑课程</th>
                                        <th>删除</th>
                                    </tr>
                                    </thead>
                                    <tbody id="list_user">
                                    <tr data-fdid="fdid325" draggable="true">
                                        <td class="tdTit">
                                            <div class="pr">
                                                <div class="state-dragable"><span class="icon-bar"></span><span
                                                        class="icon-bar"></span><span class="icon-bar"></span><span
                                                        class="icon-bar"></span><span class="icon-bar"></span></div>
                                                <img src="images/temp-face36.jpg" alt="">魏紫（weizi5@xdf.cn），广州学校 国外考试部
                                            </div>
                                        </td>
                                        <td><input type="checkbox" checked="" class="tissuePreparation"></td>
                                        <td><input type="checkbox" class="editingCourse"></td>
                                        <td><a href="#" class="icon-remove-blue"></a></td>
                                    </tr>
                                    <tr data-fdid="fdid324" draggable="true">
                                        <td class="tdTit">
                                            <div class="pr">
                                                <div class="state-dragable"><span class="icon-bar"></span><span
                                                        class="icon-bar"></span><span class="icon-bar"></span><span
                                                        class="icon-bar"></span><span class="icon-bar"></span></div>
                                                <img src="images/temp-face36.jpg" alt="">刘鹍（liukun@xdf.cn），集团总公司 知识管理中心
                                            </div>
                                        </td>
                                        <td><input type="checkbox" class="tissuePreparation"></td>
                                        <td><input type="checkbox" checked="" class="editingCourse"></td>
                                        <td><a href="#" class="icon-remove-blue"></a></td>
                                    </tr>
                                    <tr data-fdid="fdid323" draggable="true">
                                        <td class="tdTit">
                                            <div class="pr">
                                                <div class="state-dragable"><span class="icon-bar"></span><span
                                                        class="icon-bar"></span><span class="icon-bar"></span><span
                                                        class="icon-bar"></span><span class="icon-bar"></span></div>
                                                <img src="http://img.staff.xdf.cn/Photo/06/3A/a911e1178bf3725acd75ddbb9c7e3a06_9494.jpg"
                                                 alt="">杨义锋（yangyifeng@xdf.cn），集团总公司 知识管理中心
                                            </div>
                                        </td>
                                        <td><input type="checkbox" checked="" class="tissuePreparation"></td>
                                        <td><input type="checkbox" checked="" class="editingCourse"></td>
                                        <td><a href="#" class="icon-remove-blue"></a></td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div class="pr">
                                    <input type="text" id="addUser" class="autoComplete input-block-level" placeholder="请输入人名、邮箱、机构或者部门查找用户">
                                    <i class="icon-search"></i>
                                </div>
                            </div>
                        </div>
                    </section>
                    <button class="btn btn-block btn-submit btn-inverse" type="submit">保存</button>
                </form>
            </div>
	    </section>
	</section>

<!--底部 S-->
	<footer>
		<div class="navbar clearfix">
			<div class="nav">
				<li><a href="http://www.xdf.cn/" target="_blank">新东方网</a></li>
				<li><a href="http://me.xdf.cn/" target="_blank">知识管理平台</a></li>
				<li><a href="${ctx }/login">登录</a></li>
				<li><a href="${ctx }/self_register">注册</a></li>
				<li class="last"><a href="mailto:yangyifeng@xdf.cn">帮助</a></li>
			</div>
            <p style="font-size:13px">&copy; 2013 新东方教育科技集团&nbsp;知识管理中心</p>
		</div>
	</footer>
<!--底部 E-->
</section>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.placeholder.1.3.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.validate.min.js"></script>
<script type="text/javascript" src="js/messages_zh.js"></script>
<script type="text/javascript" src="js/jquery.autocomplete.pack.js"></script>
<script type="text/javascript" src="js/jquery.sortable.js"></script>
<script type="text/javascript">
$(function(){
    $.Placeholder.init();
    //授权管理 用户列表 模板函数
    var listUserKinguserFn = doT.template(document.getElementById("listUserKinguserTemplate").text);

    $("#formEditDTotal").validate({
        submitHandler: function(form){
            var data = {
                videoName: $("#videoName").val(),
                videoUrl: $("#videoUrl").val(),
                videoIntro: $("#videoIntro").val(),
                author: $("#author").val(),
                authorIntro: $("#authorIntro").val(),
                permission:$("#permission").val(),
                kingUser: null
            };
            if(data.permission === "encrypt"){
                //push人员授权数据
                data.kingUser = [];
                $("#list_user>tr").each(function(){
                    data.kingUser.push({
                        id: $(this).attr("data-fdid"),
                        index: $(this).index(),
                        tissuePreparation: $(this).find(".tissuePreparation").is(":checked"),
                        editingCourse: $(this).find(".editingCourse").is(":checked")
                    });
                });
            }
            //console.log(JSON.stringify(data));
            //ajax
            /*$.post("url?updata",data)
             .success(function(){
             alert("保存成功");
             });*/
        }
    });
    $('#formEditDTotal a[data-toggle="tab"]').on('shown', function (e) {
        var href = 	e.target.href.split("#").pop();
        $("#permission").val(href);
    });
    $("#list_user").sortable({
        handle: '.state-dragable'
    })
            .find("a.icon-remove-blue").bind("click",function(e){
                e.preventDefault();
                $(this).closest("tr").remove();
            });
    var allUserData ;

    allUserData = [
        {
            id: "fdid3232323",
            imgUrl: "http://img.staff.xdf.cn/Photo/06/3A/a911e1178bf3725acd75ddbb9c7e3a06_9494.jpg",
            name: "杨小锋",
            mail: "yangyifeng@xdf.cn",
            org: "集团总公司",
            department: "知识管理中心"
        },
        {
            id: "fdid32234",
            imgUrl: "",
            name: "刘小鹍",
            mail: "liukun@xdf.cn",
            org: "集团总公司",
            department: "知识管理中心"
        },
        {
            id: "fdid328",
            imgUrl: "",
            name: "魏小紫",
            mail: "weizi5@xdf.cn",
            org: "广州学校",
            department: "国外考试部"
        }
    ]
    /*$("#addUser").autocomplete("url.jsp",{
     dataType: "json",
     parse: function(data) {
     return $.map(data, function(row) {
     return {
     data: row,
     value: row.name,
     result: row.name + " <" + row.mail + ">"
     }
     });
     },*/
    $("#addUser").autocomplete(allUserData,{
        formatMatch: function(item) {
            return item.name + item.mail + item.org + item.department;
        },
        formatItem: function(item) {
            return '<img src="'
                    + (item.imgUrl || 'images/temp-face36.jpg') + '" alt="">'
                    + item.name + '（' + item.mail + '），'
                    + item.org + '  ' + item.department;
        },
        matchContains:true ,
        max: 10,
        scroll: false,
        width:688
    }).result(function(e,item){
                $(this).val(item.name);
                $("#list_user").append(listUserKinguserFn(item))
                        .sortable({
                            handle: '.state-dragable',
                            forcePlaceholderSize: true
                        })
                        .find("a.icon-remove-blue").bind("click",function(e){
                            e.preventDefault();
                            $(this).closest("tr").remove();
                        });

            });
});
</script>
</body>
</html>
