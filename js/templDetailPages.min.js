/*! ntp 2014-01--21 */
!function(){"use strict";function a(a){var b=["零","一","二","三","四","五","六","七","八","九","十"];return a="number"==typeof a?a:parseInt(a),a/10>1?b[a/10]+b[10]+b[a%10]:b[a]}function b(a,b,c,d,e,f){var g={chapter:void 0,lecture:void 0};return a?g.chapter={id:f,index:d,num:b,title:c}:g.lecture={id:f,index:d,num:b,title:c,type:e},g}function c(a){var b=$("#progress_courses"),c=a-$("#sortable").find(".sortable-bar>.title>.icon-none").length;b.find(".progress>.bar").width(c/a*100+"%"),b.find(".num_comp").text(c),b.find(".num_all").text(a),a>0&&(a===c?d():e())}function d(){$(window).scrollTop(0),$("#page-title>.btn-group>.btn").removeAttr("disabled")}function e(){$("#page-title>.btn-group>.btn").attr("disabled","disabled")}var f,g={},h={};f=function(){return this||(0,eval)("this")}(),f.rightCont=g;var i={pageHeader:document.getElementById("contHeaderTemplate").text},j=doT.template(document.getElementById("basicInfoTemplate").text,void 0,i),k=doT.template(document.getElementById("addKeywordInfoTemplate").text),l=doT.template(document.getElementById("tagKeywordInfoTemplate").text),m=doT.template(document.getElementById("detailInfoTemplate").text,void 0,i),n=doT.template(document.getElementById("itemDetailInfoTemplate").text),o=doT.template(document.getElementById("promotionTemplate").text,void 0,i),p=doT.template(document.getElementById("accessRightTemplate").text,void 0,i),q=doT.template(document.getElementById("kinguserTemplate").text,void 0,i),r=doT.template(document.getElementById("listUserKinguserTemplate").text),s=doT.template(document.getElementById("deleteCourseTemplate").text,void 0,i),t=doT.template(document.getElementById("mediaPageTemplate").text),u=doT.template(document.getElementById("mediaListTemplate").text),v=doT.template(document.getElementById("formEditMediaTitle").text),w=doT.template(document.getElementById("formEditSectionTitle").text),x=doT.template(document.getElementById("addSectionsTemplate").text,void 0,{edittitle:document.getElementById("formEditSectionTitle").text}),y=doT.template(document.getElementById("sectionsTemplate").text+document.getElementById("sectionBarTemplate").text+document.getElementById("lectureContentTemplate").text),z=doT.template(document.getElementById("sectionDirectoryTemplate").text+document.getElementById("sectionBarTemplate").text+document.getElementById("lectureContentTemplate").text,void 0,i);g.loadVideoPage=function(b){h={isElective:!0,learnTime:"",sectionsIntro:"",mediaList:[{id:"fdid4258924985",index:2,title:"俞老师对国外考试项目新教师致辞"},{id:"fdid4255",index:1,title:"新东方2013校园招聘"},{id:"fdid425511111",index:4,title:"国外考试新教师备课致辞"},{id:"fdid425522222",index:3,title:"国外部项目备课致辞"},{id:"fdid425500",index:5,title:"BC官员雅思考试解读"},{id:"fdid43454545222",index:6,title:"国外考试新教师在线备课平台介绍"}]},h.pageTitle=b.title,h.lectureIndex=a(b.index),h.typeTxt="视频",h.uploadIntro="上传视频（支持MP4、AVI、WMV格式的视频，建议小于10G）：成功上传的视频将会显示在下面的视频列表中。",$("#rightCont").html(t(h)),$("#listMedia").sortable().bind("sortupdate",function(){$(this).children().each(function(a){$(this).find(".title>.index").text(a+1)})}).delegate(".btn-ctrls","click",function(a){if(a.preventDefault(),$(this).hasClass("icon-remove"))$(this).parent("li").remove(),$("#mediaCount").text($("#listMedia").children("li").each(function(a){$(this).find(".title>.index").text(a+1)}).length);else if($(this).hasClass("icon-pencil2")){var b=$(this).prev(".title");$(this).parent("li").hide().after(v({typeTxt:h.typeTxt,index:b.children(".index").text(),name:b.children(".name").text()}))}}).delegate(".form-edit-title .btn","click",function(a){if(a.preventDefault(),$(this).hasClass("btn-primary")){var b=$(this).parent().prev(".control-group").find(":text").val();b&&$(this).closest(".form-edit-title").prev("li").show().find(".title>.name").text(b)}else $(this).closest(".form-edit-title").prev("li").show();$(this).closest(".form-edit-title").remove()}),$("#formMedia").validate({submitHandler:function(){var a=[];$("#listMedia>li").each(function(){a.push({id:$(this).attr("data-fdid"),index:$(this).find(".title>.index").text(),title:$(this).find(".title>.name").text()})}),$.post("url?update",{isElective:$("#isElective").val(),pageTitle:$("#lectureName").val(),learnTime:$("#learnTime").val(),sectionsIntro:$("#sectionsIntro").val(),mediaList:a}).success(function(){})}}),$("#formMedia .btns-radio>.btn").click(function(){$("#isElective").val("elective"===this.id)});var c,d=$("#listMedia"),e=!1,f=[{id:"fdid8348934020202002",name:"雅思听力"},{id:"fdid834893ewfge",name:"雅思听力练习"},{id:"fdid3ewfge4343",name:"雅思听力技巧"},{id:"fdid3lliuu23",name:"雅思听力视频"}];$("#addMedia").autocomplete(f,{formatItem:function(a){return a.name},matchContains:!0,max:10,scroll:!1,width:688}).result(function(a,b){b.typeTxt=h.typeTxt,b.index=d.children("li").length+1,c=u(b),e=!0}).next(".btn-primary").bind("click",function(){e&&(d.append(c).sortable(),$("#mediaCount").text(d.children("li").length),e=!1)})},g.loadDeleteCoursePage=function(a){h.pageTitle=a,$("#rightCont").html(s(h)),$("#deleteCourse").click(function(){urlRouter("sectionsDirectory")})},g.loadKinguserPage=function(a){h={user:[{id:"fdid323",index:2,imgUrl:"http://img.staff.xdf.cn/Photo/06/3A/a911e1178bf3725acd75ddbb9c7e3a06_9494.jpg",name:"杨义锋",mail:"yangyifeng@xdf.cn",org:"集团总公司",department:"知识管理中心",tissuePreparation:!0,editingCourse:!0},{id:"fdid324",index:1,imgUrl:"",name:"刘鹍",mail:"liukun@xdf.cn",org:"集团总公司",department:"知识管理中心",tissuePreparation:!1,editingCourse:!0},{id:"fdid325",index:0,imgUrl:"",name:"魏紫",mail:"weizi5@xdf.cn",org:"广州学校",department:"国外考试部",tissuePreparation:!0,editingCourse:!1}]},h.pageTitle=a,$("#rightCont").html(q(h)),$("#list_user").sortable({handle:".state-dragable",forcePlaceholderSize:!1}).find("a.icon-remove-blue").bind("click",function(a){a.preventDefault(),$(this).closest("tr").remove()});var b;b=[{id:"fdid3232323",imgUrl:"http://img.staff.xdf.cn/Photo/06/3A/a911e1178bf3725acd75ddbb9c7e3a06_9494.jpg",name:"杨小锋",mail:"yangyifeng@xdf.cn",org:"集团总公司",department:"知识管理中心"},{id:"fdid32234",imgUrl:"",name:"刘小鹍",mail:"liukun@xdf.cn",org:"集团总公司",department:"知识管理中心"},{id:"fdid328",imgUrl:"",name:"魏小紫",mail:"weizi5@xdf.cn",org:"广州学校",department:"国外考试部"}],$("#addUser").autocomplete(b,{formatMatch:function(a){return a.name+a.mail+a.org+a.department},formatItem:function(a){return'<img src="'+(a.imgUrl||"images/temp-face36.jpg")+'" alt="">'+a.name+"（"+a.mail+"），"+a.org+"  "+a.department},matchContains:!0,max:10,scroll:!1,width:688}).result(function(a,b){$(this).val(b.name),$("#list_user").append(r(b)).sortable({handle:".state-dragable",forcePlaceholderSize:!0}).find("a.icon-remove-blue").bind("click",function(a){a.preventDefault(),$(this).closest("tr").remove()})}),$("#submitUser").click(function(){var a=[];$("#list_user>tr").each(function(){a.push({id:$(this).attr("data-fdid"),index:$(this).index(),tissuePreparation:$(this).find(".tissuePreparation").is(":checked"),editingCourse:$(this).find(".editingCourse").is(":checked")})}),console.log(JSON.stringify(a))})},g.loadAccessRightPage=function(a){h={action:"",permission:"",encryptType:"",coursePwd:""},h.pageTitle=a,$("#rightCont").html(p(h)),$("#formAccessRight").validate({rules:{coursePwd:{required:"#passwordProtect:checked",minlength:6}},messages:{coursePwd:{required:"请输入密码",minLength:"密码必须大于6位"}}}),$("#formAccessRight #encrypt .radio").bind("click",function(){"passwordProtect"==$(this).attr("for")?($("#passwordProtect").attr("checked",!0),$("#coursePwd").removeAttr("disabled")):$("#coursePwd").attr("disabled",!0)}),$('#formAccessRight a[data-toggle="tab"]').on("shown",function(a){var b=a.target.href.split("#").pop();$("#permission").val(b),$("#encrypt").find("input").not($("#passwordProtect").is(":checked")?null:$("#coursePwd")).attr("disabled","encrypt"!==b)})},g.loadPromotionPage=function(a){h={action:"#",coverUrl:"",courseSkin:{title:"国内考试"},courseSkinList:[{title:"国外考试",imgUrl:"images/courseSkin-01.png"},{title:"国内考试",imgUrl:"images/courseSkin-02.png"},{title:"英语学习",imgUrl:"images/courseSkin-03.png"},{title:"优能中学",imgUrl:"images/courseSkin-04.png"},{title:"优能小学",imgUrl:"images/courseSkin-05.png"},{title:"默认",imgUrl:"images/courseSkin-default.png"}]},h.pageTitle=a,$("#rightCont").html(o(h)),$("#formPromotion .courseSkinList>li>a").bind("click",function(a){a.preventDefault(),$(this).parent().addClass("active").siblings().removeClass("active"),$("#courseSkin").val($(this).next("h5").text())})},g.loadDetailInfoPage=function(a){function b(a){var b=[];a.siblings(".alert").each(function(){b.push($(this).children("span").text())}),a.parent().prev(":hidden").val(b)}h={action:"#",courseAbstract:"",learnObjectives:["了解雅思考试基本情况","了解英国留学基本情况"],suggestedGroup:["新教师","学校主管"],courseRequirements:["学习本课程的教师必须通过TELTS考试","准备好3-8教材"]},h.pageTitle=a,$("#rightCont").html(m(h)),$("#formDetailInfo").validate(),$("#formDetailInfo .formAdd>.btn").bind("click",function(a){if(a.preventDefault(),$(this).prevAll(":text").val()){var c=$(this).parent().prev(".list_alert").prev(":hidden"),d=$(this).prevAll(":text").val(),e=$(n(d));e.bind("closed",b),$(this).parent().removeClass("warning").prev(".list_alert").append(e);var f=c.val();c.val(f+","+d),$(this).prevAll(":text").val("")}else $(this).parent().addClass("warning")}),$("#formDetailInfo .list_alert>.alert").bind("closed",function(){b($(this))})},g.loadBasicInfoPage=function(a){function b(a){var b=[];a.siblings(".alert-tag").each(function(){b.push($(this).children("span").text())}),$("#keyword").val(b)}h={action:"#",courseTit:"集团英联邦项目雅思强化口语备课课程",subTit:"",sectionOrder:"learningDisorder",keyword:["雅思","新教师备课"],courseTypeList:["小学辅导","中学辅导","大学考试","中学辅导","大学考试","多语种","夏冬令营"],courseType:"小学辅导"},h.pageTitle=a,$("#rightCont").html(j(h)),$("#formBasicInfo").validate(),$("#formBasicInfo").find(".btns-radio>.btn").on("click",function(){$("#sectionOrder").val(this.id)}),$("#formBasicInfo .keywordWrap>.btn-add").bind("click",function(a){a.preventDefault();var c=$(this);c.next().hasClass("inpKeyword")||c.after(k()).next(".inpKeyword").children(".btn").bind("click",function(a){if(a.preventDefault(),$(this).hasClass("btn-primary"))if($(this).prevAll(":text").val()){var d=$(this).prevAll(":text").val();c.before(l({keyword:d})).prev().bind("closed",b);var e=$("#keyword").val();$("#keyword").val(e+","+d),$(this).parent().remove()}else $(this).parent().addClass("warning");else $(this).parent().remove()})}),$("#formBasicInfo .keywordWrap>.alert-tag").bind("closed",function(){b($(this))}),$("#formBasicInfo .courseType>li>a").bind("click",function(a){a.preventDefault(),$(this).parent().addClass("active").siblings().removeClass("active"),$("#courseType").val($(this).text())})},g.loadSectionDirectoryPage=function(a){function d(){var a,b=e.children("li"),c=1,d=1,f={chapter:[],lecture:[]};b.each(function(b){a=$(this),a.hasClass("chapter")?(a.find(".title>.index").text(c),f.chapter.push({index:b,num:c++,id:a.attr("data-fdid")})):a.hasClass("lecture")&&(a.find(".title>.index").text(d),f.lecture.push({index:b,num:d++,id:a.attr("data-fdid")}))}),$.post("url",f,function(){},"json")}h={chapter:[{id:"fdid3214321",index:0,num:1,title:"业务学习"},{id:"fdid3221",index:4,num:2,title:"学术准备"}],lecture:[{id:"fdid32210000",index:2,num:2,title:"学习入门文档",isElective:!1,type:"doc"},{id:"fdid32210239",index:1,num:1,title:"学习入门视频",isElective:!0,type:"video"},{id:"fdid3frewf239",index:3,num:3,title:"参加在线考试",isElective:!1,type:"none"},{id:"fdid3frewf000111",index:6,num:5,title:"参加在线考试",isElective:!0,type:"task"},{id:"fdid3frewf000111",index:5,num:4,title:"参加学术考试",isElective:!1,type:"video"}]},h.pageTitle=a,$("#rightCont").html(z(h)),c($("#sortable").children(".lecture").length);var e=$("#sortable");e.sortable({handle:".sortable-bar",forcePlaceholderSize:!0}).bind("sortupdate",d).delegate(".sortable-bar>.icon-pencil2","click",function(a){a.preventDefault();var c=$(this).prev(".title"),d=b(c.closest("li").hasClass("chapter"),c.children(".index").text(),c.children(".name").text());$(this).closest(".sortable-bar").addClass("hide").after(w(d))}).delegate(".sortable-bar>.icon-remove","click",function(a){a.preventDefault();var b=$(this).closest("li");b.remove(),d(),c(e.children(".lecture").length)}).delegate(".sortable-bar>.btn-edit","click",function(a){a.preventDefault(),$(this).parent().next(".lecture-content").length&&$(this).addClass("hide").parent().next(".lecture-content").removeClass("hide")}).delegate(".lecture-content>.hd>a.icon-remove-sign","click",function(a){a.preventDefault(),$(this).closest(".lecture-content").addClass("hide").prevAll(".sortable-bar").children(".btn-edit").removeClass("hide")}).delegate(".form-edit-title .btn-primary","click",function(a){a.preventDefault();var d,f=$(this).closest(".form-edit-title"),g=f.find("input.input-block-level"),h=f.parent("li");if(g.val()){if(f.prev().hasClass("sortable-bar"))h.children(".sortable-bar").removeClass("hide").find(".name").text(g.val());else{var i="sectionId0"+Math.random();d=b(h.hasClass("chapter"),f.find(".index").text(),g.val(),h.length,"none"),h.attr("data-fdid",i),f.before(y(d)),e.sortable("destroy").sortable({handle:".sortable-bar",forcePlaceholderSize:!0});var j=f.find(".index").text();c(j)}f.remove()}else f.find(".control-group:first").addClass("warning").find(":text").after('<span class="help-block">请填写标题！</span>')}).delegate(".form-edit-title .btn-link","click",function(a){a.preventDefault(),$(this).closest(".form-edit-title").prev(".sortable-bar").removeClass("hide").end().remove()}).delegate(":text","keydown",function(){$(this).val()&&$(this).closest(".control-group").hasClass("warning")&&$(this).closest(".control-group").removeClass("warning").find(".help-block").remove()}).delegate(".lecture-content>.bd>.btn-type","click",function(a){if($(this).hasClass("disabled"))a.preventDefault();else{var b=$(this).closest(".lecture-content").prev().find(".title");urlRouter(!1,{id:$(this).closest(".lecture").attr("data-fdid"),title:b.find(".name").text(),index:b.find(".index").text()})}}),$("#addChapter").bind("click",function(){if(e.children(".chapter").last().children(".form-edit-title").length)e.children(".chapter").last().find(".form-edit-title .control-group:first").addClass("warning").find(":text").after('<span class="help-block">请先完成未保存的章！</span>');else{var a={chapter:{index:e.children("li").length,num:e.children(".chapter").length+1}};e.append(x(a))}}),$("#addLecture").bind("click",function(){if(e.children(".lecture").last().children(".form-edit-title").length)e.children(".lecture").last().find(".form-edit-title .control-group:first").addClass("warning").find(":text").after('<span class="help-block">请先完成未保存的节！</span>');else{var a={lecture:{index:e.children("li").length,num:e.children(".lecture").length+1}};e.append(x(a))}})}}();